name: &name "original_strats"
description: &description "Pretrain on original Strats data and hyperparams"
stage: &stage "pretrain"

metric: &metric val_epoch_loss
metric_mode: &metric_mode min

wandb_logger:
  project: Strats
  job_type: *stage
  name: *name
  notes: *description

results_dir: /home/user/.cache/thesis/results

module_config:
  model:
    #  demographics_num: train_data.num_demographics,
    #  features_num: train_data.num_variables,
    hid_dim: 64
    num_layers: 2
    num_heads: 16
    dropout: 0.2
    attention_dropout: 0.2
    head: 'forecast'
  optimizer:
    lr: 5.0e-4


_common_dataset_: &common_dataset
  max_events: 880
  max_minute: 1440 # 24 * 60
  min_input_minutes: 720 # 12*60

data_config:
  bootstrap: false

  train:
    batch_size: 16
    path: /home/user/.cache/thesis/data/original_strats_data/train
    variables_dropout: 0.2
    <<: *common_dataset

  val:
    batch_size: 32
    path: /home/user/.cache/thesis/data/original_strats_data/val
    variables_dropout: 0
    repeat_times: 3
    <<: *common_dataset

  test:
    batch_size: 32
    path: /home/user/.cache/thesis/data/original_strats_data/test
    variables_dropout: 0
    repeat_times: 3
    <<: *common_dataset


trainer:
  max_epochs: 60
  gradient_clip_val: 0.3
  precision: bf16-mixed
  accumulate_grad_batches: 1


checkpoint_callback:
  monitor: *metric
  mode: *metric_mode
  every_n_epochs: 1
  save_top_k: -1
  dirpath: /home/user/.cache/thesis/checkpoints/pretrain

early_stop_callback:
  monitor: *metric
  mode: *metric_mode
  patience: 10
